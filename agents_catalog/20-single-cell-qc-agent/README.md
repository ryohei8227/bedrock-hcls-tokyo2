# Single Cell QC Analysis Agent

## Overview

The Single Cell QC Analysis Agent is an Amazon Bedrock agent designed to help scientists validate the quality of single cell gene expression assays. It analyzes web summary files generated by 10x Genomics Cell Ranger and validates them against technical interpretation guidelines to identify potential quality issues or anomalies.

## Features

- **Web Summary Analysis**: Extracts key metrics and visualizations from Cell Ranger web summary files
- **Technical Validation**: Compares metrics against established guidelines to identify quality issues
- **Comprehensive Reporting**: Provides detailed analysis with clear pass/fail indicators and explanations

## Use Cases

- Validating single cell RNA-seq experiments before downstream analysis
- Quality control for large-scale single cell genomics projects
- Identifying technical issues in gene expression assays
- Standardizing QC processes across research teams

## Architecture

The agent consists of two main action groups:

1. **WebSummaryAnalyzer**: Retrieves and analyzes web summary files from S3
2. **QCValidator**: Validates metrics against technical guidelines

Both action groups are implemented as AWS Lambda functions that leverage Amazon Bedrock for document analysis and interpretation.

## Deployment

### Prerequisites

- AWS account with access to Amazon Bedrock
- Access to Claude 3.5 Sonnet model in Amazon Bedrock
- S3 bucket containing web summary files and technical documents

### Deployment Steps

1. Deploy the CloudFormation template:

```bash
aws cloudformation deploy \
  --template-file single-cell-qc-agent-cfn.yaml \
  --stack-name single-cell-qc-agent \
  --capabilities CAPABILITY_IAM
```

2. Note the agent ID and alias from the CloudFormation outputs.

3. Make sure that lambda power tools  are added as a  layer to the lambda functions

4. Store the relevant qc metrics and report validator documents in S3

## Usage

The agent can be invoked through the Amazon Bedrock console or API with the following parameters:

### Analyze Web Summary

```json
{
  "web_summary_s3_uri": "s3://bucket-name/path/to/web_summary.html"
}
```

### Validate QC Metrics

```json
{
  "web_summary_s3_uri": "s3://bucket-name/path/to/web_summary.html",
  "technical_doc_s3_uri": "s3://bucket-name/path/to/technical_document.pdf"
}
```

## Example Output

```
QC Analysis Results for Sample: Breast_Cancer_3p

Key Metrics:
- Estimated Number of Cells: 5,243
- Mean Reads per Cell: 92,415
- Median Genes per Cell: 2,512
- Sequencing Saturation: 85.2%
- Q30 Bases in RNA Read: 92.3%
- Q30 Bases in Barcode: 95.1%
- Q30 Bases in UMI: 94.8%

Validation Results:
✅ Cell Count: PASS (Expected range: 1,000-10,000)
✅ Sequencing Saturation: PASS (>80% recommended)
✅ Q30 Scores: PASS (All Q30 metrics >90%)
⚠️ Median Genes per Cell: WARNING (Lower than typical for breast tissue)
✅ Fraction Reads in Cells: PASS (>70%)

Recommendations:
- The sample shows generally good quality metrics
- The lower than expected genes per cell may indicate some cell stress or RNA degradation
- Proceed with analysis but consider potential impact on gene detection sensitivity
```

## License

This project is licensed under the MIT-0 License.
